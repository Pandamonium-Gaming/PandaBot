#!/bin/bash
# Pre-commit hook to validate version synchronization using the .NET VersionManager tool

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}üîç Validating version synchronization...${NC}"

# Check if VersionManager DLL exists, build if not
DLL_PATH="artifacts/bin/VersionManager/release/VersionManager.dll"
if [ ! -f "$DLL_PATH" ]; then
    echo -e "${YELLOW}VersionManager not built. Building now...${NC}"
    dotnet build tools/VersionManager/VersionManager.csproj -c Release -q
    if [ $? -ne 0 ]; then
        echo -e "${RED}‚ùå Failed to build VersionManager${NC}"
        exit 1
    fi
fi

# Run the VersionManager tool
dotnet "$DLL_PATH" validate

if [ $? -ne 0 ]; then
    echo ""
    echo -e "${RED}‚ùå Commit blocked: Version mismatch!${NC}"
    echo ""
    echo -e "${YELLOW}Fix versions using:${NC}"
    echo "  dotnet artifacts/bin/VersionManager/release/VersionManager.dll bump --version X.X.X --type patch --message 'Your message'"
    echo ""
    exit 1
fi

echo -e "${GREEN}‚úì Pre-commit hook passed!${NC}"
exit 0
